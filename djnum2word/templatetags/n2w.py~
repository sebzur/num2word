#! -*- coding: utf-8 -*-

from django import template
from apap3.contracts.models.base import GridNodeContract

register = template.Library()

@register.tag(name="n2w")
def do_n2w(parser, token):
    try:
        tag_name, identifier, date, option = token.split_contents()
    except ValueError:
        raise template.TemplateSyntaxError(
            "%r tag requires three arguments" % token.contents.split()[0]
        )
    if not (option[0] == option[-1] and option[0] in ('"', "'")):
        raise template.TemplateSyntaxError(
            "%r tag's third argument should be in quotes" % tag_name
        )

    return N2W(identifier, date, option[1:-1])


class N2W(template.Node):
        def __init__(self, identifier, date, option):
            self.identifier = template.Variable(identifier)
            self.date = template.Variable(date)
            self.option = option

        def render(self, context):
            if self.option == "number":
                obj = GridNodeContract.objects.get(id = self.identifier.resolve(context))
                date = self.date.resolve(context)
                print obj.get_amount(date)
                return obj.get_amount(date)
